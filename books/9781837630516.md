# [Mastering Linux Security and Hardening](books/9781837630516.md)
<img alt="Mastering Linux Security and Hardening" src="../covers/9781837630516.jpg" width="200"/>

## Chapter 1/16

Installing a virtual machine in VirtualBox

Download and install VirtualBox and the VirtualBox Extension Pack. You can get them from https://www.virtualbox.org/.

Download the installation .iso files for Ubuntu Server 22.04, CentOS 7, AlmaLinux8, and AlmaLinux9. You can get them from https://ubuntu.com/, https://almalinux.org/, and https://www.centos.org/.

Start VirtualBox and click the New icon at the top of the screen. Fill out the information where requested. Increase the virtual drive size to 20 GB, but leave everything else as the default

Start the new virtual machine. Click on the folder icon that’s beside the Location dialog box and navigate to the directory where you stored the .iso fi les that you downloaded.

installing Ubuntu

Repeat the procedure for the other Linux distros.

Installing the EPEL repository on the CentOS 7 virtual machine

While the Ubuntu package repositories have pretty much everything that you need for this course, the CentOS and AlmaLinux package repositories are—shall we say—lacking.

you’ll need to install the EPEL repository. 
(The EPEL project is run by the Fedora team.) When you install third-party repositories on Red Hat 7 and CentOS 7 systems, you’ll also need to install a priorities package and edit the .repo fi les to set the proper priorities for each repository. This will prevent packages from the third-party repository from overwriting of f i cial Red Hat and CentOS packages if they just happen to have the same name.

1. The two packages that you’ll need to install EPEL are in the normal CentOS 7 repositories. To install them, just run this command:

```sh
sudo yum install yum-plugin-priorities epel-release
``````

2. When the installation completes, navigate to the /etc/yum.repos.d directory, and open the CentOS-Base.repo fi le in your favorite text editor. Af t er the last line of the base, updates, and extras sections, add the line priority=1. Af t er the last line of the centosplus section, add the line priority=2.

3. Open the epel.repo fi le for editing. Af t er the last line of the epel section, add the line priority=10. Af t er the last line of each remaining section, add the line priority=11.

4. Update the system and then create a list of the installed and available packages by running the following commands:

```sh
sudo yum upgrade sudo yum list > yum_list.txt
``````

Installing the EPEL repository on the AlmaLinux 8/9 virtual machines

To install the EPEL repository on AlmaLinux, all you have to do is run this command:
sudo dnf install epel-release There’s no priorities package as there is on CentOS 7 and earlier, so we won’t have to worry about conf i guring the repository priorities.
When the package installation is complete, update the system and create a list of available sof t ware packages with these two commands:

```sh
sudo dnf upgrade sudo dnf list > dnf_list.txt
``````

Configuring a network for VirtualBox virtual machines

Creating a virtual machine snapshot with VirtualBox

Keeping the Linux systems updated

Spend some time perusing the Common Vulnerabilities and Exposures database, and you’ll soon see why it’s so important to keep your systems updated.

https://cve.mitre.org/

Updating Debian-based systems

run two commands, as shown here:

```sh
sudo apt update sudo apt dist-upgrade
``````

Occasionally, you’ll also need to remove some old packages that are no longer needed.

```sh
sudo apt auto-remove
``````

Configuring auto updates for Ubuntu

When you fi rst install Ubuntu 22.04, automatic updates are turned on by default. To verify that, you’ll fi rst check the status of the unattended-upgrades service, like so:

```sh
systemctl status unattended-upgrades
``````

Then, look in the `/etc/apt/apt.conf.d/20auto-upgrades` fi le. If auto-updating is enabled, you’ll see this:

```sh
APT::Periodic::Update-Package-Lists "1";
APT::Periodic::Unattended-Upgrade "1";
``````

By default, Ubuntu systems don’t automatically reboot af t er an update is installed. If you keep it that way, you’ll see a message about it when you log into the system. 
But if you prefer, you can set Ubuntu to automatically reboot af t er it automatically updates itself.

1. Go into the `/etc/apt/apt.conf.d` directory and open the `50unattended-upgrades` fi le in your favorite text editor. In the vicinity of line 67, you’ll see a line that says:

```sh
Unattended-Upgrade::Automatic-Reboot "false";
``````

3. With this new conf i guration, Ubuntu will now reboot itself immediately af t er the automatic update process has completed. If you’d rather have the machine reboot at a specif i c time, scroll down to about line 103, where you’ll see this:

```sh
//Unattended-Upgrade::Automatic-Reboot-Time "02:00";
``````

5. To disable automatic updates, just go into the `/etc/apt/apt.conf.d` directory and open the `20auto-upgrades` fi le in your favorite text editor. Here’s what you’ll see:

```sh
APT::Periodic::Update-Package-Lists "1";
APT::Periodic::Unattended-Upgrade "1";
``````

6. Change the parameter for that second line to 0, so that the fi le will now look like this:

```sh
APT::Periodic::Update-Package-Lists "1";
APT::Periodic::Unattended-Upgrade "0";
``````

1. If you want to see if there are any security-related updates available, but don’t want to see any non-security updates, use the unattended-upgrade command, like so:

```sh
sudo unattended-upgrade --dry-run -d
``````

8. To manually install the security-related updates without installing non-security updates, just run:

```sh
sudo unattended-upgrade -d
``````

Also, if you’re running a non-Ubuntu fl avor of Debian, which would include Rasp-bian for the Raspberry Pi, you can give it the same functionality as Ubuntu by installing the unattended-upgrades package. Just run this command:

```sh
sudo apt install unattended-upgrades
``````

Updating Red Hat 7-based systems

With Red Hat-based systems, which include CentOS and Oracle Linux, there’s no automatic update mechanism that you can set up during installation. So, with the default conf i guration, you’ll need to perform updates yourself:

1. To update a Red Hat 7-based system, just run this one command:

```sh
sudo yum upgrade
``````

2. Sometimes, you might just want to see if there are any security-related updates that are ready to be installed. Do that by running this command:

```sh
sudo yum updateinfo list updates security
``````

3. If any security updates are available, you’ll see them at the end of the command output.

1. If the only thing you want to install is the security updates, run this command:

```sh
sudo yum upgrade --security
``````

1. Now, let’s say that you need a CentOS system to automatically update itself. You’re in luck because there’s a package for that. Install and enable it, and start it by running these two commands:

```sh
sudo yum install yum-cron sudo systemctl enable --now yum-cron
``````

6. To conf i gure it, go into the `/etc/yum` directory, and edit the `yum-cron.conf` fi le.

1. Let’s say that you only want security updates to get applied automatically. Just change the last line to the following:

```sh
update_cmd = security
``````

1. On lines 15 and 20, you’ll see this:

```sh
download_updates = yes apply_updates = no
``````

This indicates that by default, yum-cron is only set to automatically download updates, but not to install them.
2. If you want the updates to get automatically installed, change the apply_updates parameter to yes.

Note that unlike Ubuntu, there’s no setting to make the system automatically reboot itself af t er an update.

11. Finally, let’s look at the mail settings for yum-cron, which you’ll fi nd on lines 48 through 57 of the yum-cron.conf fi le

As you can see, the email_to = line is set to send messages to the root user account. If you want to receive messages on your own account, just change it here.

12. To see the messages, you’ll need to install a mail reader program, if one isn’t already installed. 
(It hasn’t been installed if

you chose Minimal installation when you installed the operating system.) Your best bet is to install mutt, like so:

```sh
sudo yum install mutt
``````

14. As with all operating systems, certain updates will require that the system be restarted. And how do you know when the system needs to be restarted? With the needs-restarting com-mand, of course. First, though, you need to make sure that needs-restarting is installed on your system. Do that with this command:

```sh
sudo yum install yum-utils
``````

* `sudo needs-restarting`: This shows the services that need to be restarted, and the reasons why the system might need to be rebooted.
* `sudo needs-restarting -s`: This only shows the services that need to be restarted.
* `sudo needs-restarting -r`: This only shows the reasons why the system needs to be rebooted.

Updating Red Hat 8/9-based systems

For the most part, you use dnf the same way that you’d use yum, with the same arguments and options. For example, to do a system upgrade, just do:
sudo dnf upgrade

2. The main functional dif f erence between yum and dnf is that dnf has a dif f erent automatic update mechanism. Instead of installing the yum-cron package, you’ll now install the dnf-automatic package, like so:

```sh
sudo dnf install dnf-automatic
``````

3. In the /etc/dnf directory, you’ll see the automatic.conf fi le, which you’ll conf i gure the same way as you did the yum-cron.conf fi le for CentOS 7. Instead of working as a cron job, as the old yum-cron did, dnf-automatic works with a systemd timer. When you fi rst install dnf-automatic, the timer is disabled. Enable it and start it by running this command:

```sh
sudo systemctl enable --now dnf-automatic.timer
``````

4. Verify that it’s running with this command:

```sh
sudo systemctl status dnf-automatic.timer
``````

5. If it started successfully, you should see something like this when you check the status:

```sh
sudo systemctl status dnf-automatic.timer
```

To determine if a system needs to be restarted, just install the yum-utils package and run the needs-restarting command, the same as you did for CentOS 7. (For some reason, the Red Hat developers never bothered to change the package name to dnf-utils.)

Managing updates in an enterprise

In an enterprise setting, there are two additional considerations:
• You want to restrict what packages the end users are allowed to install.
• You always want to test updates on a separate test network before allowing them to be installed on a production network.

For these reasons, enterprises will of t en set up their own repository servers that only have approved packages and approved updates.

Further reading

https://linuxsecurity.com/

## Chapter 2/16
## Chapter 3/16
## Chapter 4/16
## Chapter 5/16
## Chapter 6/16
## Chapter 7/16
## Chapter 8/16
## Chapter 9/16
## Chapter 10/16
## Chapter 11/16
## Chapter 12/16
## Chapter 13/16
## Chapter 14/16
## Chapter 15/16
## Chapter 16/16
